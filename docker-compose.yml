version: '3'
services:
    store:
        build: ./Store   
        ports: 
            - "4000:8080"
        restart: always
        depends_on: 
            - mysql_server
            - mongodb
        environment: 
            - MYSQL_HOST=mysql_server
            - MYSQL_PASSWORD=password
            - MYSQL_USER=admin
            - MYSQL_DATABASE=everything
            - MYSQL_PORT=3306

    product:
        build: ./Product   
        depends_on: 
            - mongodb
        ports: 
            - "4001:8080"
        restart: always
        links:
            - mongodb
        restart: always

    cart:
        build: ./Cart
        ports: 
            - "4002:8080"
        restart: always

    nginx:
        image: nginx
        ports:
            - "8080:8080"
        volumes:
            - ./Nginx/nginx.conf:/etc/nginx/nginx.conf:ro
            - ./Nginx/certs:/etc/nginx/certs:ro
        restart: always
  
    mongodb:
        image : mongo:latest
        container_name: mongodb
        volumes:
            - mongodb_data_container:/data/db
        ports:
            - 27017:27017
        restart: unless-stopped
    
    # mysql:
    #     image: mysql:8.0
    #     restart: always
    #     environment: 
    #         - MYSQL_DATABASE=everything
    #         - MYSQL_USER=admin
    #         - MYSQL_PASSWORD=password
    #         - MYSQL_ROOT_PASSWORD=password
        # ports: 
        #     - 3036:3306
        # volumes:
        #     - mysql-db-config:/etc/mysql
        #     - mysql-db-data:/var/lib/mysql
        #     - ./db/backup/files/:/data_backup/data
    mysql_server:
        image: mysql:8.0
        environment: 
            - MYSQL_DATABASE=everything
            - MYSQL_USER=admin
            - MYSQL_PASSWORD=password
            - MYSQL_ROOT_PASSWORD=password

volumes:
    mongodb_data_container:
    mysql-db-config:
    mysql-db-data:

# networks:
#   web:
#     driver: bridge
